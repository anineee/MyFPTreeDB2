# 论文阅读与前期工作总结
姓名：陆俞因，廖婕， 陈文丰<br/>
学号：17343081，17343072，

---
## 前期工作

### 使用示意图展示普通文件IO方式(fwrite等)的流程，即进程与系统内核，磁盘之间的数据交换如何进行？为什么写入完成后要调用fsync？
![普通文件IO方式示意图](http://blog.chinaunix.net/attachment/201207/11/27105712_13419741441gpp.gif)

普通文件IO需要穿越多层，从进程写到系统内核，再从系统内核最终写到磁盘。

`fwrite()`是系统提供的最上层接口，作用是在用户进程空间开辟**CLib buffer**，将多次小数据量相邻写操作先从**application buffer**拷贝到**CLib buffer**缓存起来，如果此时进程终止，数据会丢失。此时可以调用`fclose()`主动将**CLib buffer**的数据刷新到磁盘介质上。

一种方式是调用`write()`，将数据从应用层中的**CLib buffer**的数据一次性拷贝到内核层中的**page cache**，此时会触发内核态/用户态的切换。数据到达**page cache**后由内核IO调度决定何时写入磁盘。另一种方式是调用`fflush()`将数据从**CLib buffer**拷贝到**page cache**中。

内核中pdflush不停监测脏页，判断是否要写回到磁盘中，并将需要写回的页提交到IO队列中，根据IO调度队列的调度策略决定何时写回。从IO队列出来后，进入驱动层，驱动层通过DMA将数据写入**disk cache**。由磁盘控制器决定何时将**disk cache**的数据写到磁盘介质上，或是通过调用`fsync()`主动将**page cache**中的数据刷新到磁盘上。
